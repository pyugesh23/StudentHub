{% extends "base.html" %}

{% block title %}Memory Match{% endblock %}

{% block container_class %}container mt-2{% endblock %}

{% block content %}
<style>
    body {
        background: #020617;
        background-image:
            radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
            radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%);
        color: white;
    }

    .game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem 2rem;
        max-width: 900px;
        margin: 0 auto;
    }

    .memory-title {
        font-family: 'Outfit', sans-serif;
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(to right, #fff, #f1e05a);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .game-stats {
        display: flex;
        gap: 2rem;
        color: #94a3b8;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .memory-grid {
        display: grid;
        grid-template-columns: repeat(4, 100px);
        gap: 15px;
        perspective: 1000px;
    }

    .memory-card {
        width: 100px;
        height: 140px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.5s;
        cursor: pointer;
    }

    .memory-card.flipped {
        transform: rotateY(180deg);
    }

    .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .card-front {
        background: #1e293b;
        border: 2px solid rgba(255, 255, 255, 0.1);
        color: #f1e05a;
    }

    .card-back {
        background: #f1e05a;
        color: #020617;
        transform: rotateY(180deg);
    }

    .controls {
        display: flex;
        gap: 1rem;
    }

    .btn-game {
        padding: 0.85rem 2rem;
        border-radius: 12px;
        border: none;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-reset {
        background: #f1e05a;
        color: #020617;
    }

    .btn-reset:hover {
        filter: brightness(1.1);
        transform: translateY(-2px);
    }

    .win-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(8px);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .win-content {
        background: #1e293b;
        padding: 3rem;
        border-radius: 32px;
        border: 2px solid #f1e05a;
        text-align: center;
    }
</style>

<div class="game-container">
    <div class="text-center">
        <h1 class="memory-title">Memory Match</h1>
        <div class="game-stats">
            <span>Moves: <span id="moves">0</span></span>
            <span>Pairs: <span id="pairs">0</span>/8</span>
        </div>
    </div>

    <div class="memory-grid" id="grid">
        <!-- Cards will be generated here -->
    </div>

    <div class="controls">
        <button class="btn-game btn-reset" onclick="resetGame()">Reset Game</button>
        <a href="{{ url_for('games.hub') }}" class="btn-game"
            style="background: rgba(255,255,255,0.1); color: white; text-decoration: none;">Back to Hub</a>
    </div>
</div>

<div class="win-overlay" id="winOverlay">
    <div class="win-content">
        <h2 style="font-size: 3rem; color: #f1e05a; margin-bottom: 1rem;">Fantastic! ðŸŽ‰</h2>
        <p style="font-size: 1.5rem; color: #94a3b8; margin-bottom: 2rem;">You finished in <span
                id="finalMoves">0</span> moves!</p>
        <button class="btn-game btn-reset" onclick="resetGame()">Play Again</button>
    </div>
</div>

<script>
    const icons = ['ðŸ”¥', 'ðŸ’»', 'ðŸš€', 'âš¡', 'ðŸŒ™', 'ðŸŽ¨', 'ðŸ•¹ï¸', 'ðŸ§ª'];
    let cards = [...icons, ...icons];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let canFlip = true;

    const grid = document.getElementById('grid');
    const movesDisplay = document.getElementById('moves');
    const pairsDisplay = document.getElementById('pairs');
    const winOverlay = document.getElementById('winOverlay');

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function createCard(icon) {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.innerHTML = `
            <div class="card-face card-front">?</div>
            <div class="card-face card-back">${icon}</div>
        `;
        card.onclick = () => flipCard(card);
        card.dataset.icon = icon;
        return card;
    }

    function flipCard(card) {
        if (!canFlip || card.classList.contains('flipped') || flippedCards.includes(card)) return;

        card.classList.add('flipped');
        flippedCards.push(card);

        if (flippedCards.length === 2) {
            moves++;
            movesDisplay.textContent = moves;
            canFlip = false;
            checkMatch();
        }
    }

    function checkMatch() {
        const [card1, card2] = flippedCards;
        if (card1.dataset.icon === card2.dataset.icon) {
            matchedPairs++;
            pairsDisplay.textContent = matchedPairs;
            flippedCards = [];
            canFlip = true;
            if (matchedPairs === 8) {
                setTimeout(showWin, 500);
            }
        } else {
            setTimeout(() => {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
                flippedCards = [];
                canFlip = true;
            }, 1000);
        }
    }

    function showWin() {
        document.getElementById('finalMoves').textContent = moves;
        winOverlay.style.display = 'flex';
    }

    function resetGame() {
        matchedPairs = 0;
        moves = 0;
        flippedCards = [];
        canFlip = true;
        movesDisplay.textContent = '0';
        pairsDisplay.textContent = '0';
        winOverlay.style.display = 'none';

        grid.innerHTML = '';
        shuffle(cards).forEach(icon => {
            grid.appendChild(createCard(icon));
        });
    }

    resetGame();
</script>
{% endblock %}